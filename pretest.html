<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>臉盲症前測問卷</title>
 
</head>
<body>
  <div class="container">
    <h1>臉盲症前測問卷</h1>
    <form id="pretestForm">

      <label class="option-label">性別</label>
      <select name="entry.92676064" required>
        <option value="不願透露">不願透露</option>
        <option value="女">女</option>
        <option value="非二元／其他">非二元／其他</option>
        <option value="男">男</option>
      </select>

      <label class="option-label">年齡區間</label>
      <select name="entry.1440226800" required>
        <option value="18歲以下">18 歲以下</option>
        <option value="18–23歲">18–23 歲</option>
        <option value="24–29歲">24–29 歲</option>
        <option value="30–35歲">30–35 歲</option>
        <option value="36–41歲">36–41 歲</option>
        <option value="42–47歲">42–47 歲</option>
        <option value="48–53歲">48–53 歲</option>
        <option value="54–59歲">54–59 歲</option>
        <option value="60–65歲">60–65 歲</option>
        <option value="65歲以上">65 歲以上</option>
      </select>

      <label class="option-label">你是否聽過「臉盲症」？</label>
      <select name="entry.813456672" required>
        <option value="沒聽過">沒聽過</option>
        <option value="有聽過，但不太清楚是什麼">有聽過，但不太清楚是什麼</option>
        <option value="有基本了解">有基本了解</option>
        <option value="很熟悉，了解相關特徵">很熟悉，了解相關特徵</option>
      </select>

      <label class="option-label">當你聽到有人說「我有臉盲症」，你的第一反應是什麼？</label>
      <div class="radio-group vertical-radio-group">
        <label class="option-label"><input type="radio" name="entry.1156211354" value="真的假的，這樣生活不會很困難嗎？"> 真假的，這樣生活不會很困難嗎？</label> <!--好奇 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="是不是你根本沒在記人啊？"> 是不是你根本沒在記人啊？</label> <!--否定 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="這是一種病嗎？我沒聽過耶"> 這是一種病嗎？我沒聽過耶</label> <!--無知 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="我其實也有點記不得臉耶～"> 我其實也有點記不得臉耶～</label> <!--錯誤連結 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="還好吧，應該沒有差很多吧"> 還好吧，應該沒有差很多吧</label> <!--錯誤連結 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="沒關係，我下次會記得報上名來"> 沒關係，我下次會記得報上名來</label> <!--錯誤連結 -->
        <label class="option-label"><input type="radio" name="entry.1156211354" value="其他"> 其他</label>
      </div>

      <label class="option-label">臉盲症主要影響什麼？</label>
      <div class="radio-group">
        <label class="option-label"><input type="radio" name="entry.1801148399" value="視力清晰度"> 視力清晰度</label>
        <label class="option-label"><input type="radio" name="entry.1801148399" value="面部辨識能力"> 面部辨識能力</label>
        <label class="option-label"><input type="radio" name="entry.1801148399" value="語言理解能力"> 語言理解能力</label>
        <label class="option-label"><input type="radio" name="entry.1801148399" value="短期記憶力"> 短期記憶力</label>
      </div>

      <label class="option-label">臉盲症是否可以透過記得人的臉部特徵認人？</label>
      <div class="radio-group">
        <label class="option-label"><input type="radio" name="entry.1421852872" value="是"> 是</label>
        <label class="option-label"><input type="radio" name="entry.1421852872" value="否"> 否</label>
        <label class="option-label"><input type="radio" name="entry.1421852872" value="有些人有效"> 有些人有效</label>
        <label class="option-label"><input type="radio" name="entry.1421852872" value="不知道"> 不知道</label>
      </div>

      <label class="option-label">你覺得一個人可能認不得自己的父母嗎？</label>
      <div class="radio-group">
        <label class="option-label"><input type="radio" name="entry.950890420" value="不可能"> 不可能</label>
        <label class="option-label"><input type="radio" name="entry.950890420" value="可能是記性差"> 可能是記性差</label>
       <label class="option-label"><input type="radio" name="entry.950890420" value="有可能"> 有可能</label>
        <label class="option-label"><input type="radio" name="entry.950890420" value="我不確定"> 我不確定</label>
      </div>

      <label class="option-label">你曾聽過或相信過哪些關於臉盲症的說法？（可複選）</label>
      <div class="checkbox-group">
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="藉口"> 臉盲是藉口，只是不小心忘記</label>
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="冷漠"> 臉盲的人太冷漠</label>
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="視力不好"> 臉盲是視力不好</label>
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="多看幾次就好"> 多看幾次就會好</label>
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="認知障礙"> 臉盲是一種認知障礙</label>
        <label class="option-label"><input type="checkbox" name="entry.431943649" value="被當玩笑"> 常被當玩笑的個性描述</label>
      </div>

      <label class="option-label">你覺得臉盲症者可能會用什麼方式認人？（可複選）</label>
      <div class="checkbox-group">
        <label class="option-label"><input type="checkbox" name="entry.38844532" value="聲音"> 聲音</label>
        <label class="option-label"><input type="checkbox" name="entry.38844532" value="髮型"> 髮型</label>
        <label class="option-label"><input type="checkbox" name="entry.38844532" value="衣著"> 衣著</label>
        <label class="option-label"><input type="checkbox" name="entry.38844532" value="走路姿勢"> 走路姿勢</label>
        <label class="option-label"><input type="checkbox" name="entry.38844532" value="表情細節"> 表情細節</label>
      </div>

    

      <label>請依下列句子，選擇你認同的程度（1～5）</label>
      <div class="likert">
        <!-- Likert 題從 Q16 開始 -->
        <label>不認得別人的臉是一種沒禮貌的行為</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.585861773" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.585861773" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.585861773" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.585861773" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.585861773" value="5"> 5（非常同意）</label>
        </div>
        <label>如果有人說自己有臉盲症，我會懷疑他是不是在逃避或找藉口</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1151198679" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1151198679" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1151198679" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1151198679" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1151198679" value="5"> 5（非常同意）</label>
        </div>
        <label>臉盲症不像障礙，比較像是一種個性</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.337820256" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.337820256" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.337820256" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.337820256" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.337820256" value="5"> 5（非常同意）</label>
        </div>
        <label>如果朋友認不得我，我會感到受傷</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.2093647434" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.2093647434" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.2093647434" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.2093647434" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.2093647434" value="5"> 5（非常同意）</label>
        </div>
        <label>我能想像臉盲者在人際互動中的焦慮感</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1782892410" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1782892410" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1782892410" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1782892410" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1782892410" value="5"> 5（非常同意）</label>
        </div>
        <label>我相信臉盲症是真實存在的神經認知差異</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1091473655" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1091473655" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1091473655" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1091473655" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1091473655" value="5"> 5（非常同意）</label>
        </div>
        <label>我覺得臉盲症和「看不出臉孔的情節」只存在於電影或小說裡</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.219396079" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.219396079" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.219396079" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.219396079" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.219396079" value="5"> 5（非常同意）</label>
        </div>
        <label>即使有人解釋過臉盲症，我仍然很難理解那是什麼樣的狀態</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1141386741" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1141386741" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1141386741" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1141386741" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1141386741" value="5"> 5（非常同意）</label>
        </div>
        <label>我曾經懷疑別人說自己臉盲只是不小心忘記</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1217812374" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1217812374" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1217812374" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1217812374" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1217812374" value="5"> 5（非常同意）</label>
        </div>
        <label>我覺得在職場上，臉盲症者應該主動解釋自己的狀況</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1440205633" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1440205633" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1440205633" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1440205633" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1440205633" value="5"> 5（非常同意）</label>
        </div>
        <label>我會不自覺對認不得我的人產生負面情緒 例如：覺得被忽視</label>
        <div class="radio-group">
          <label class="option-label"><input type="radio" name="entry.1647624551" value="1"> 1（非常不同意）</label>
          <label class="option-label"><input type="radio" name="entry.1647624551" value="2"> 2</label>
          <label class="option-label"><input type="radio" name="entry.1647624551" value="3"> 3</label>
          <label class="option-label"><input type="radio" name="entry.1647624551" value="4"> 4</label>
          <label class="option-label"><input type="radio" name="entry.1647624551" value="5"> 5（非常同意）</label>
        </div>
      <!-- 開放式題目 -->
    <label>你覺得「忘記別人長相」這件事在日常生活中會帶來什麼困擾？</label>
    <textarea name="entry.1766261555" rows="3"></textarea>

        <!-- 送出按鈕 -->
    <button type="submit">送出問卷</button>

    </form>
  </div>

 <script type="module">
    console.log("🔥 Firebase module script loaded");

    // ① 從 CDN import Firebase App + Firestore
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ② 把下面換成你自己的 config
    const firebaseConfig = {
      apiKey: "AIzaSyCcvdCI2S4to-z3PsqOhkdS-w85bXBJLPk",
      authDomain: "face-pretest.firebaseapp.com",
      projectId: "face-pretest",
      storageBucket: "face-pretest.appspot.com",
      messagingSenderId: "529428391860",
      appId: "1:529428391860:web:3f18c27ab0e6178fc9f4e1"
    };

    // ③ 初始化
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ② 先定義這個函式──放在最前面
    function generateCode(len = 6) {
      return Math.random()
        .toString(36)
        .substr(2, len)
        .toUpperCase();
    }
    // ④ 表單 + 驗證設定
    const form = document.getElementById("pretestForm");
    const requiredCheckboxes = ["entry.431943649","entry.38844532"];
    const requiredRadios = [
      "entry.1156211354","entry.1801148399","entry.1421852872","entry.950890420",
      "entry.585861773","entry.1151198679","entry.337820256","entry.2093647434",
      "entry.1782892410","entry.1091473655","entry.219396079","entry.1141386741",
      "entry.1217812374","entry.1440205633","entry.1647624551"
    ];

    form.addEventListener("submit", async e => {
      console.log("🚀 submit 事件觸發");
      e.preventDefault();

    // 產生六碼大寫代號
    function generateCode(len=6){
      return Math.random().toString(36).substr(2,len).toUpperCase();
    }
  
      if (!form.checkValidity()) return form.reportValidity();

      // 多選
      for (const name of requiredCheckboxes) {
        const boxes = form.elements[name];
        if (![...boxes].some(cb=>cb.checked)) {
          boxes[0].scrollIntoView({behavior:"smooth",block:"center"});
          return alert("請至少勾選一個「可複選」題目");
        }
      }
      // 單選
      for (const name of requiredRadios) {
        const radios = form.elements[name];
        if (![...radios].some(rb=>rb.checked)) {
          radios[0].scrollIntoView({behavior:"smooth",block:"center"});
          return alert("有題目尚未作答，請完整填寫問卷！");
        }
      }

        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;          // 禁用按鈕
        submitBtn.textContent = '送出中…';  // 改文字提醒

      // ⑤ 用 FormData 一次抓所有 entry.xxx
      const fd = new FormData(form);
      const payload = {};
      for (const [key, val] of fd) {
        payload[key] = payload[key] ? payload[key] + "; " + val : val;
      }
      payload.submittedAt = new Date().toISOString();

  // —— 新增：產生唯一代號並放入 payload —— 
      const participantCode = generateCode();  
      payload.participantCode = participantCode;

  try {
    // 只寫入 pretestResponses
    await addDoc(collection(db, "pretestResponses"), payload);

    // 存 code 並導向故事頁
    localStorage.setItem("participantCode", participantCode);
    location.href = 'story.html';

  } catch (err) {
    // 寫入失敗：提示並恢復按鈕
    alert('送出失敗：' + err.message);
    submitBtn.disabled = false;
    submitBtn.textContent = '送出前測';
  }
});

    //—— sparkles 互動效果 ——  
    const shapes = ['shape-circle','shape-star','shape-diamond'];
    const colors = ['#00ffe1','#ff33cc','#ffee00','#66ccff','#ffffff','#39ff14','#f72585'];
    document.querySelectorAll(".option-label input").forEach(input => {
      input.addEventListener("change", e => {
        const label = e.target.closest("label");
        label.classList.add("clicked");
        setTimeout(()=> label.classList.remove("clicked"),200);
        for (let i=0;i<12;i++){
          const sparkle = document.createElement("span");
          sparkle.classList.add('sparkle', shapes[Math.floor(Math.random()*shapes.length)]);
          sparkle.style.setProperty('--x',`${(Math.random()-0.5)*250}px`);
          sparkle.style.setProperty('--y',`${(Math.random()-0.5)*250}px`);
          sparkle.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
          const dur = 300 + Math.random()*500;
          sparkle.style.animationDuration = `${dur}ms`;
          sparkle.style.width = sparkle.style.height = `${6+Math.random()*16}px`;
          sparkle.style.opacity = `${0.5+Math.random()*0.5}`;
          label.appendChild(sparkle);
          setTimeout(()=> sparkle.remove(), dur+100);
        }
      });
    });

  </script>
</body>
</html>
